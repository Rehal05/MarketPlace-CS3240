{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Login</title>
  <link rel="stylesheet" href="{% static 'login.css' %}">
</head>
<body>

  <div class="auth-card">
    <h2>Login to Profile</h2>
    <p id = "sub-text">Sign in to access your moderator profile or switch to the user dashboard.</p>

    {% if form.errors %}
      <p style="color:#fca5a5; margin-bottom: 12px;">
        Invalid username or password. Please try again.
      </p>
    {% endif %}

    <form method="post" action="">
      {% csrf_token %}
      {{ form.as_p }}

      <!-- This hidden field controls where the user is sent after login -->
      <input type="hidden" name="next" id="next-field" value="/dashboard/">

      <button type="submit">Sign in</button>
    </form>

    <p style="margin-top: 16px; color: var(--muted); font-size: 0.9rem;">
      <a href="#" id="toggle-link">Switch to Moderator Dashboard</a>
    </p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const link = document.getElementById('toggle-link');
      const titleLine = document.querySelector('.auth-card h2');
      const nextField = document.getElementById('next-field');
      const subText = document.getElementById("sub-text");

      // default is profile unless stored as 'moderator'
      let isProfile = localStorage.getItem('dashboardMode') !== 'moderator';

      function updateUI() {
        if (isProfile) {
          link.textContent = 'Switch to Moderator Dashboard';
          titleLine.textContent = 'Login to Profile';
          nextField.value = '/dashboard/';
          subText.value = "Sign in to access your profile or switch to the moderator dashboard";
        } else {
          link.textContent = 'Switch to Profile';
          titleLine.textContent = 'Login to Moderator Dashboard';
          nextField.value = '/accounts/moderator/dashboard/';
          subText.value = "Sign in to access your moderator profile or switch to the user dashboard";
        }
      }

      updateUI();

      link.addEventListener('click', function (event) {
        event.preventDefault();
        isProfile = !isProfile;
        localStorage.setItem('dashboardMode', isProfile ? 'profile' : 'moderator');
        updateUI();
      });
    });
  </script>

</body>
</html>
