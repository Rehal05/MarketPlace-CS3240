# Source / AI Citation
# AI Use: Generated with ChatGPT 5.1.
#   Prompt: The code we wrote + "make this less ugly and work"

{% load static tz %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>User Directory</title>
  <link rel="stylesheet" href="{% static 'login.css' %}">
</head>
<body class="page user-directory-page">

  <main class="content">

    <header class="top-nav-bar">
      <div class="nav-inner">
        <div class="nav-left">
          <h1 class="page-title">User Directory</h1>
          <p class="page-subtitle">Overview of all registered users</p>
        </div>
        <nav class="top-nav">
          <a href="/accounts/moderator/dashboard" class="btn btn-secondary">
            ← Back to dashboard
          </a>
        </nav>
      </div>
    </header>

    {% if users %}
      <section class="card">
        <header class="card-header">
          <h2 class="card-title">Users</h2>
          <p class="card-meta">{{ users|length }} total</p>
        </header>

        <ul class="user-list">
          {% for user in users %}
            <li class="user-card">
              <div class="user-card-main">
                <div class="user-card-header">
                  <span class="user-name">{{ user.username }}</span>
                  {% if user.email %}
                    <span class="user-email">&lt;{{ user.email }}&gt;</span>
                  {% endif %}
                </div>

                <div class="user-meta-row">
                  {% if user.user_type %}
                    <span class="user-role-pill">
                      {{ user.get_user_type_display }}
                    </span>
                  {% endif %}

                  {% if user.is_superuser %}
                    <span class="user-badge badge-admin">Admin</span>
                  {% elif user.is_staff %}
                    <span class="user-badge badge-staff">Staff</span>
                  {% endif %}
                </div>

                {% if user.last_login %}
                  <div class="user-last-login">
                    Last login:
                    {{ user.last_login|timezone:"US/Eastern"|date:"M d, Y h:i A" }}
                  </div>
                {% else %}
                  <div class="user-last-login user-last-login--never">
                    Never logged in
                  </div>
                {% endif %}
              </div>

              <div class="user-card-side" style="display:flex; flex-direction:column; gap:0.4rem; align-items:flex-end;">
                {% if not user.is_superuser %}
                  <span class="verified-badge">
                    ✓ Email Verified
                  </span>
                {% else %}
                  <span class="verified-badge verified-badge--ghost">
                    Superuser
                  </span>
                {% endif %}

                <!-- New: moderator action to view this user's conversations -->
                <a href="{% url 'admin_conversations' user.id %}" class="btn btn-secondary" style="font-size:0.78rem; padding:6px 10px;">
                  View conversations
                </a>
              </div>
            </li>
          {% endfor %}
        </ul>
      </section>
    {% else %}
      <section class="card empty-card">
        <p class="empty-state">No users found.</p>
      </section>
    {% endif %}
  </main>

</body>
</html>
